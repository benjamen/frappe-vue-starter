import{_ as K,T as Q,U as ee,r as D,Z as L,x as U,A as te,X as oe,a as re,o as s,b as a,d as r,j as se,w as ae,i as x,t as u,F as f,k as V,n as $,f as F,H as y,$ as le,I as ne,W as k,v as j,a0 as de,a1 as ie,Y as w}from"./index-CBDyEeFS.js";const ue={class:"w-full p-4 lg:p-6 xl:p-8 space-y-6 lg:space-y-8"},ce={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},me={class:"flex-1 text-center"},pe={class:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white"},ye={class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},ge={key:0,class:"flex items-center justify-center py-12"},be={key:1,class:"bg-white dark:bg-gray-900 shadow-lg rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden"},xe={key:0,class:"border-b border-gray-200 dark:border-gray-700 pb-4"},he={class:"text-lg sm:text-xl font-semibold text-blue-700 dark:text-blue-300"},ve={key:0,class:"text-red-500 ml-1"},fe=["type","step","placeholder","onUpdate:modelValue","required","readonly","autocomplete"],ke=["onUpdate:modelValue","required","disabled"],we={value:"",disabled:""},_e=["value"],Ce=["onUpdate:modelValue","required","readonly"],qe={key:4,class:"flex items-center gap-3"},Ve=["onUpdate:modelValue","required","disabled","value","onInput"],Fe=["onUpdate:modelValue","readonly"],Te={key:5,class:"relative"},De=["placeholder","onUpdate:modelValue","onInput","onFocus","onBlur","required","readonly"],Le={key:0,class:"absolute z-20 left-0 right-0 mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-lg rounded-lg max-h-48 overflow-y-auto"},Se=["onMousedown"],Ee={class:"font-medium text-gray-900 dark:text-gray-100"},Ue=["placeholder","onUpdate:modelValue","required","readonly","rows"],$e={key:7,class:"flex items-start gap-3"},Be=["onUpdate:modelValue","required","id","disabled"],Me=["for"],Ae={key:0,class:"text-red-500 ml-1"},Ie={key:8,class:"space-y-2"},Ne=["onChange","required","disabled","accept"],je={class:"text-xs text-gray-500 dark:text-gray-400"},Pe=["placeholder","onUpdate:modelValue","required","readonly"],ze={key:10,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},We={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 pt-6 border-t border-gray-200 dark:border-gray-700"},Re=["disabled"],He={key:1,class:"hidden sm:block"},Je={class:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto"},Oe=["disabled"],Ge={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Xe={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ye=["disabled"],Ze={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Ke={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qe={key:2,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 text-center"},et={class:"bg-gray-50 dark:bg-gray-800 rounded-lg"},tt={class:"px-4 pb-4 space-y-4"},ot={class:"bg-gray-900 text-gray-100 rounded-lg p-4 text-xs overflow-x-auto border"},rt={class:"bg-gray-900 text-gray-100 rounded-lg p-4 text-xs overflow-x-auto border"},st={class:"bg-gray-900 text-gray-100 rounded-lg p-4 text-xs overflow-x-auto border"},at={__name:"WebFormPage",setup(lt){const g=Q(),B=ee(),_=D(g.params.name),c=D(null),m=D(!1),n=L({}),b=D(null),T=U(()=>g.query.doc||null),h=U(()=>g.query.new==1||!T.value),C=L({}),q=L({}),v=L({});let S={};function P(o){return o===1?"grid-cols-1":o===2?"grid-cols-1 md:grid-cols-2":o===3?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":o===4?"grid-cols-1 md:grid-cols-2 lg:grid-cols-4":`grid-cols-1 md:grid-cols-2 lg:grid-cols-${Math.min(o,6)}`}function z(o){const t=o.label.toLowerCase().includes("description")||o.description?.toLowerCase().includes("description")||o.fieldname.toLowerCase().includes("description");return o.fieldtype==="Long Text"||o.fieldtype==="Text Editor"?t?10:8:o.fieldtype==="Small Text"?t?5:3:o.fieldtype==="Text"&&t?8:5}function W(o){const t=[];let d={label:"",columns:[[]]},i=d.columns[0];return o.forEach(p=>{p.fieldtype==="Section Break"?((d.columns.some(E=>E.length)||d.label&&d.label.trim())&&t.push(d),d={label:p.label||"",columns:[[]]},i=d.columns[0]):p.fieldtype==="Column Break"?(i=[],d.columns.push(i)):p.fieldtype==="Page Break"||i.push(p)}),(d.columns.some(p=>p.length)||d.label&&d.label.trim())&&t.push(d),t}const R=U(()=>W(c.value?.web_form_fields||[]));function M(o){return/^#[0-9a-fA-F]{6}$/.test(o)?o:"#000000"}function H(o,t){/^#[0-9a-fA-F]{6}$/.test(t)&&(n[o]=t)}function J(o){const t=C[o.fieldname];if(!t||t.length<1||o.read_only){q[o.fieldname]=[];return}S[o.fieldname]&&clearTimeout(S[o.fieldname]),S[o.fieldname]=setTimeout(async()=>{try{const d=await w("frappe.client.get_list",{doctype:o.options,fields:["name"],filters:[["name","like",`%${t}%`]],limit_page_length:10});q[o.fieldname]=(d?.message||d||[]).map(i=>({value:i.name,label:i.name})),v[o.fieldname]=!0}catch{q[o.fieldname]=[],v[o.fieldname]=!1}},180)}function O(o,t){C[o]=t.label,n[o]=t.value,v[o]=!1}function G(o){setTimeout(()=>{v[o]=!1},160)}async function A(){m.value=!0,c.value=null,b.value=null;try{const o=await w("frappe.client.get",{doctype:"Web Form",name:_.value});c.value=o?.message||o||null,!h.value&&T.value&&await I(),c.value&&Array.isArray(c.value.web_form_fields)&&c.value.web_form_fields.forEach(t=>{if(t.fieldname){let d=!h.value&&b.value&&b.value[t.fieldname]||"";n[t.fieldname]=t.fieldtype==="Color"?M(d):d,t.fieldtype==="Link"&&(C[t.fieldname]=d)}})}catch(o){console.error("[WebFormPage] Error fetching webform/meta/doc:",o),c.value=null}m.value=!1}async function I(){try{const o=await w("frappe.client.get",{doctype:c.value.doc_type,name:T.value});b.value=o?.message||o||null}catch(o){b.value=null,console.error("[WebFormPage] Error fetching doc:",o)}}function X(o,t){const d=o.target.files[0];n[t]=d}async function Y(){if(confirm("Are you sure you want to delete this record? This action cannot be undone."))try{m.value=!0,await w("frappe.client.delete",{doctype:c.value.doc_type,name:T.value});const o=document.createElement("div");o.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",o.textContent="Record deleted successfully!",document.body.appendChild(o),setTimeout(()=>o.remove(),3e3),B.push(`/form/${_.value}/list`)}catch(o){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent="Failed to delete: "+(o.message||o),document.body.appendChild(t),setTimeout(()=>t.remove(),5e3),console.error("[WebFormPage] Error deleting record:",o)}finally{m.value=!1}}async function N(){try{if(m.value=!0,h.value){const o=await w("frappe.client.insert",{doc:{doctype:c.value.doc_type,...n}}),t=document.createElement("div");t.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent="Record created successfully!",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3),B.push(`/form/${_.value}/list`)}else{const o={...b.value,...n};await w("frappe.client.save",{doc:o});const t=document.createElement("div");t.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent="Record updated successfully!",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3),await I()}}catch(o){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent="Failed to save: "+(o.message||o),document.body.appendChild(t),setTimeout(()=>t.remove(),5e3),console.error("[WebFormPage] Error saving form:",o)}finally{m.value=!1}}return te(A),oe(()=>[g.params.name,g.query.doc,g.query.new],()=>{_.value=g.params.name,A()}),(o,t)=>{const d=re("router-link");return s(),a("div",ue,[r("div",ce,[c.value?.show_list?(s(),se(d,{key:0,to:`/form/${_.value}/list`,class:"inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors"},{default:ae(()=>t[2]||(t[2]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),r("span",{class:"hidden sm:inline"},"Back to List",-1)])),_:1,__:[2]},8,["to"])):x("",!0),r("div",me,[r("h1",pe,u(c.value?.title),1),r("p",ye,u(h.value?"Create new entry":"Edit existing entry"),1)]),t[3]||(t[3]=r("div",{class:"hidden sm:block w-24 lg:w-32"},null,-1))]),m.value?(s(),a("div",ge,t[4]||(t[4]=[r("div",{class:"flex items-center gap-3"},[r("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),r("span",{class:"text-gray-600 dark:text-gray-400"},"Loading form...")],-1)]))):c.value?(s(),a("div",be,[r("form",{onSubmit:t[1]||(t[1]=j(i=>N(),["prevent"])),class:"p-4 sm:p-6 lg:p-8 space-y-6 lg:space-y-8"},[(s(!0),a(f,null,V(R.value,(i,p)=>(s(),a(f,{key:p},[i.label&&i.label.trim()?(s(),a("div",xe,[r("h2",he,u(i.label),1)])):x("",!0),r("div",{class:$(["grid gap-4 sm:gap-6 lg:gap-8",P(i.columns.length)])},[(s(!0),a(f,null,V(i.columns,(E,Z)=>(s(),a("div",{key:Z,class:"space-y-4 sm:space-y-6"},[(s(!0),a(f,null,V(E,e=>(s(),a("div",{key:e.name,class:"form-field"},[e.fieldtype!=="Check"?(s(),a("label",{key:0,class:$(["block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",{"text-gray-400 dark:text-gray-500":e.read_only}])},[F(u(e.label)+" ",1),e.reqd?(s(),a("span",ve,"*")):x("",!0)],2)):x("",!0),["Data","Int","Float","Password","Email","Phone"].includes(e.fieldtype)?y((s(),a("input",{key:1,type:e.fieldtype==="Password"?"password":e.fieldtype==="Email"?"email":e.fieldtype==="Phone"?"tel":e.fieldtype==="Int"||e.fieldtype==="Float"?"number":"text",step:e.fieldtype==="Float"?"any":void 0,class:"form-input",placeholder:e.description||`Enter ${e.label.toLowerCase()}`,"onUpdate:modelValue":l=>n[e.fieldname]=l,required:e.reqd,readonly:e.read_only,autocomplete:e.fieldtype==="Password"?"new-password":"off"},null,8,fe)),[[le,n[e.fieldname]]]):e.fieldtype==="Select"?y((s(),a("select",{key:2,class:"form-input","onUpdate:modelValue":l=>n[e.fieldname]=l,required:e.reqd,disabled:e.read_only},[r("option",we,"Select "+u(e.label),1),(s(!0),a(f,null,V(e.options?e.options.split(`
`).filter(Boolean):[],l=>(s(),a("option",{key:l,value:l},u(l),9,_e))),128))],8,ke)),[[ne,n[e.fieldname]]]):e.fieldtype==="Date"?y((s(),a("input",{key:3,type:"date",class:"form-input","onUpdate:modelValue":l=>n[e.fieldname]=l,required:e.reqd,readonly:e.read_only},null,8,Ce)),[[k,n[e.fieldname]]]):e.fieldtype==="Color"?(s(),a("div",qe,[y(r("input",{type:"color",class:"h-12 w-16 rounded border border-gray-300 dark:border-gray-700 cursor-pointer disabled:cursor-not-allowed","onUpdate:modelValue":l=>n[e.fieldname]=l,required:e.reqd,disabled:e.read_only,value:M(n[e.fieldname]),onInput:l=>H(e.fieldname,l.target.value)},null,40,Ve),[[k,n[e.fieldname]]]),y(r("input",{type:"text",class:"form-input flex-1",placeholder:"#000000","onUpdate:modelValue":l=>n[e.fieldname]=l,readonly:e.read_only,pattern:"^#[0-9A-Fa-f]{6}$"},null,8,Fe),[[k,n[e.fieldname]]])])):e.fieldtype==="Link"?(s(),a("div",Te,[y(r("input",{type:"text",class:"form-input",placeholder:`Search ${e.options||"records"}...`,"onUpdate:modelValue":l=>C[e.fieldname]=l,onInput:l=>J(e),onFocus:l=>v[e.fieldname]=!0,onBlur:l=>G(e.fieldname),required:e.reqd,readonly:e.read_only,autocomplete:"off"},null,40,De),[[k,C[e.fieldname]]]),v[e.fieldname]&&q[e.fieldname]?.length?(s(),a("ul",Le,[(s(!0),a(f,null,V(q[e.fieldname],l=>(s(),a("li",{key:l.value,class:"px-4 py-3 cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/30 border-b border-gray-100 dark:border-gray-700 last:border-b-0 transition-colors",onMousedown:j(nt=>O(e.fieldname,l),["prevent"])},[r("div",Ee,u(l.label),1)],40,Se))),128))])):x("",!0)])):["Text","Small Text","Long Text","Text Editor"].includes(e.fieldtype)?y((s(),a("textarea",{key:6,class:"form-input",placeholder:e.description||`Enter ${e.label.toLowerCase()}`,"onUpdate:modelValue":l=>n[e.fieldname]=l,required:e.reqd,readonly:e.read_only,rows:z(e)},null,8,Ue)),[[k,n[e.fieldname]]]):e.fieldtype==="Check"?(s(),a("div",$e,[y(r("input",{type:"checkbox","onUpdate:modelValue":l=>n[e.fieldname]=l,class:"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",required:e.reqd,id:e.fieldname,disabled:e.read_only},null,8,Be),[[de,n[e.fieldname]]]),r("label",{for:e.fieldname,class:$(["text-sm font-medium text-gray-900 dark:text-gray-100 cursor-pointer",{"text-gray-400 dark:text-gray-500":e.read_only}])},[F(u(e.label)+" ",1),e.reqd?(s(),a("span",Ae,"*")):x("",!0)],10,Me)])):["Attach Image","Attach","Attach File"].includes(e.fieldtype)?(s(),a("div",Ie,[r("input",{type:"file",class:"block w-full text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-700 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-800 focus:outline-none",onChange:l=>X(l,e.fieldname),required:e.reqd,disabled:e.read_only,accept:e.fieldtype==="Attach Image"?"image/*":void 0},null,40,Ne),r("p",je,u(e.fieldtype==="Attach Image"?"Images only":"Any file type"),1)])):y((s(),a("input",{key:9,type:"text",class:"form-input",placeholder:e.description||`Enter ${e.label.toLowerCase()}`,"onUpdate:modelValue":l=>n[e.fieldname]=l,required:e.reqd,readonly:e.read_only},null,8,Pe)),[[k,n[e.fieldname]]]),e.description&&e.fieldtype!=="Check"?(s(),a("p",ze,u(e.description),1)):x("",!0)]))),128))]))),128))],2)],64))),128)),r("div",We,[h.value?(s(),a("div",He)):(s(),a("button",{key:0,type:"button",onClick:Y,disabled:m.value,class:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white font-medium text-sm rounded-lg shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:cursor-not-allowed"},t[5]||(t[5]=[r("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"})],-1),F(" Delete ")]),8,Re)),r("div",Je,[r("button",{type:"submit",disabled:m.value,class:"inline-flex items-center justify-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-semibold text-base rounded-lg shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:cursor-not-allowed w-full sm:w-auto"},[m.value?(s(),a("svg",Ge,t[6]||(t[6]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(s(),a("svg",Xe,t[7]||(t[7]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),F(" "+u(m.value?"Saving...":"Save"),1)],8,Oe),r("button",{type:"button",onClick:t[0]||(t[0]=i=>N()),disabled:m.value,class:"inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold text-base rounded-lg shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed w-full sm:w-auto"},[m.value?(s(),a("svg",Ze,t[8]||(t[8]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(s(),a("svg",Ke,t[9]||(t[9]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)]))),F(" "+u(m.value?"Saving...":h.value?"Create & Close":"Save & Close"),1)],8,Ye)])])],32)])):(s(),a("div",Qe,t[10]||(t[10]=[ie('<div class="flex items-center justify-center space-x-2" data-v-cb56e039><svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-cb56e039><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-cb56e039></path></svg><span class="text-red-800 dark:text-red-400 font-medium" data-v-cb56e039>Form not found</span></div><p class="text-red-600 dark:text-red-500 text-sm mt-2" data-v-cb56e039> The requested form could not be loaded. Please check the form name and try again. </p>',2)]))),r("details",et,[t[14]||(t[14]=r("summary",{class:"cursor-pointer p-4 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"},[r("span",{class:"font-medium"},"Debug Information"),r("span",{class:"text-xs ml-2"},"(Click to expand)")],-1)),r("div",tt,[r("div",null,[t[11]||(t[11]=r("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-2"},"WebForm JSON",-1)),r("pre",ot,u(JSON.stringify(c.value,null,2)),1)]),r("div",null,[t[12]||(t[12]=r("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-2"},"Document Values",-1)),r("pre",rt,u(JSON.stringify(b.value,null,2)),1)]),r("div",null,[t[13]||(t[13]=r("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-2"},"Form Values",-1)),r("pre",st,u(JSON.stringify(n,null,2)),1)])])])])}}},it=K(at,[["__scopeId","data-v-cb56e039"]]);export{it as default};
//# sourceMappingURL=WebFormPage-cHTSBIR_.js.map
